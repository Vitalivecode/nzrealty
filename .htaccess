<IfModule mod_rewrite.c>
    RewriteEngine On

    # Redirect to HTTPS if not already using HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # Ensure the correct DirectoryIndex
    DirectoryIndex index.php

    # Exclude specific files and directories from being rewritten
    RewriteCond $1 !^(index\.php|robots\.txt|favicon\.ico|css|js|img|downloads|jquery|forums|(.*)\.swf)$
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d

    # Rewrite all other URLs to index.php
    RewriteRule ^(.*)$ index.php/$1 [L,QSA]
</IfModule>

<IfModule !mod_rewrite.c>
    # If mod_rewrite is not available, fall back to a 404 page
    ErrorDocument 404 /index.php
</IfModule>
